# URL Shortener
## Описание

Классический сервис для сокращения ссылок, написанный на Golang. 
Использовался Postgres в качестве основной персистентной базы данных и Redis в качестве кэша для уменьшения latency и нагрузки на Postgres.



## API

```
GET http://localhost                       # Отдает домашнюю html страницу
GET http://localhost/api/v1/{shortUrl}
# Проксирует короткий URL на заданный URL
POST /api/v1/data/shorten           # Создаёт короткий URL

POST /user/register # Регистрирует пользователя
POST /user/login # Аутентификация пользователся пользователя
POST /user/refresh # стандартная операция refresh


DELETE /api/v1/data/shorten/delete # Только для зарегистрированных пользователей(для админов)

```

## Алгоритм хэширования

Среди всех возможных алгоритмов хэширования, используемых для генерации уникального кода для каждого URL-адреса, необходимо учитывать следующие проблемы:

1. **Длина кода**: Длина уникального кода имеет решающее значение, поскольку цель этого инструмента как раз и состоит в том, чтобы сгенерировать как можно меньший URL-адрес

2. **Коллизия кода**: Использование очень маленьких кодов (или маленьких словарей) может уменьшить количество возможных кодов и, таким образом, привести к коллизиям кода.

Учитывая вышеуказанные проблемы, было решено использовать Twitter snowflake ID в качестве уникального ID.

В качестве метода сокращения будем использовать преобразование base62

Внутренний алгоритм, используемый при реализации решения, имеет длину 62 символа. Используя такой словарь и учитывая, что коды допустимы, если их длина не превышает 7 символов, это дает нам максимум 3,5 триллиона комбинаций.


## Установка и запуск

Есть 2 варианта установки: `local, dev`. Рассмотрим каждую из них.

1) `local`
Назначение: для дебага.

```
docker-compose up redis postgres

# Ждём пока все запустится... 
# Отслеживать можно по логам

# Применяем миграции к Postgres:
migrate -path migrations -database 'postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable'  up

# Запускаем App. Можно в режиме дебага.
go run cmd/main.go -env config/.env

Для локального хранения заменяем ENTRYPOINT команду в Dockerfile на следующую:
ENTRYPOINT [ "./app", "-env", "/etc/url-shortener/.env", "-d"]

=> http://localhost
=> Profit!
```

2) `dev`
Назначение: Используется для тестирования перед отправкой на `prod`.
```
make compose

# Ждём пока все запустится... 
# Отслеживать можно по логам

# Применяем миграции к Postgres:
migrate -path migrations -database 'postgres://postgres:postgres@localhost:5432/postgres?sslmode=disable'  up

Для локального хранения заменяем ENTRYPOINT команду в Dockerfile на следующую:
ENTRYPOINT [ "./app", "-env", "/etc/url-shortener/.env", "-d"]

=> http://localhost
=> Profit!
```

![](./docs/dashboards.png)

![](./docs/image.png)